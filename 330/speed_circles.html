<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Speed Circles</title>
	<style type="text/css">
		body{
			background: #dddddd;
			font-family:verdana,tahoma,sans-serif;
			font-size:.8em;
		}

		#canvas,#controls{
			background: #ffffff;
			cursor: pointer;
			margin: 10px;
		}
		
		#controls{
			padding:5px;
			width:790px;
		}
		
		#controls div{
			margin-bottom:5px;
		}
		
		#assignment{
			margin-left: 10px;
			margin-top: 10px;
		}
	</style>
	<script src="./tinycolor.js"></script>
	<script>
		"use strict";
		
		// global variables
		var paletteSize, palette;
		setPalette(4);	
		var canvas, ctx, boxChecked, sliderValue, dragging, mouse, scheme, colorSet;
		var baseColor = '#337711';
		var FUDGE_DIVISOR = 2.5;
		
		/* init() is called when the page loads */
		function init() {
			canvas = document.querySelector("#canvas");
			ctx = canvas.getContext("2d");

			canvas.addEventListener("mouseleave", () => {
				dragging = false;
			});

			canvas.addEventListener("mousedown",  (e) => {
				dragging = true;
				mouse = getMouse(e);
			});

			canvas.addEventListener("mouseup",    () => {
				dragging = false;
			});

			canvas.addEventListener("mousemove", (e) => {
				if(!dragging) return;

				var oldMouseX = mouse.x;
				var oldMouseY = mouse.y;
			
				mouse = getMouse(e);
				var distance = distanceBetween(oldMouseX,oldMouseY,mouse.x,mouse.y)
				let color = getRandomPalette();
				color.setAlpha(1);
				if(boxChecked) color.setAlpha(0.5);
				drawCircle(mouse.x, mouse.y, distance/FUDGE_DIVISOR, color);
			});
		
			document.querySelector("#clearButton").onclick = clearCanvas; 
			
			document.querySelector("#saveButton").onclick = function(e){
				// open a new window and load the image in it
				// http://www.w3schools.com/jsref/met_win_open.asp
				var data = canvas.toDataURL(); 
				var windowName = "canvasImage";
				var windowOptions = "left=0,top=0,width=" + canvas.width + ",height=" + canvas.height +",toolbar=0,resizable=0";
				var myWindow = window.open(data,windowName,windowOptions);
				myWindow.resizeTo(canvas.width,canvas.height); // needed so Chrome would display image
			 };
			 
			document.querySelector("#slider1").onchange = function(e){
				 document.querySelector("#sliderResults").innerHTML = e.target.value;
				 setPalette(e.target.value);		
			 };
			 
			document.getElementById('myCheckbox').onchange = function(e){
				boxChecked = e.target.checked;
				document.querySelector("#checkboxResults").innerHTML = boxChecked ? "checked" : "";
			};	
			 
		}
		
		function drawCircle(x,y,radius,fillColor){
			ctx.fillStyle = fillColor;
			ctx.beginPath();
			ctx.arc(x, y, radius, 0, Math.PI*2, false); 
 			ctx.fill();
		}
		
		function  clearCanvas(){
			ctx.clearRect(0, 0, canvas.width, canvas.height);
		}
		
		// adjusts coordinates of mouse over the window, to local mouse coordinates over the canvas
		function getMouse(e){
			return {
				'x' : e.pageX - e.target.offsetLeft,
				'y' : e.pageY - e.target.offsetTop
			};	
		}
		
		// returns a random color of alpha 1.0
		// http://paulirish.com/2009/random-hex-color-code-snippets/
		function getRandomColor(){
   			var red   = Math.round(Math.random()*254+1);
   			var green = Math.round(Math.random()*254+1);
   			var blue  = Math.round(Math.random()*254+1);
   			return tinycolor('rgb('+red+','+green+','+blue+')');
		}
		function getRandomPalette(){
			return palette[Math.floor(Math.random()*palette.length)];
		}
		
		// used to calculate how fast the mouse is moving
		function distanceBetween(x1,y1,x2,y2){
			const dx = x2 - x1;
			const dy = y2 - y1;
			return Math.sqrt(dx*dx + dy*dy);
		}
		function setColor(c){
			baseColor = c;
			setColorSet();
		}
		function setScheme(c){
			scheme = c;
			setColorSet();
		}
		function setColorSet(){
			if(!colorSet) return;
			switch(scheme){
				case 'triad':
					palette = tinycolor(baseColor).triad();
					break;
				case 'tetrad':
					palette = tinycolor(baseColor).tetrad();
					break;
				case 'monochromatic':
					palette = tinycolor(baseColor).monochromatic();
					break;
				case 'analogous':
					palette = tinycolor(baseColor).analogous();
					break;
			}
			palette.map(function(v){ return v.toHexString() });
		}
		function setPalette(c){
			if(!c) return;
			paletteSize = +c;
			palette = Array.apply(null, new Array(paletteSize)).map(getRandomColor);
		}
		function setType(c){
			colorSet = c;
			if(colorSet) setPalette(paletteSize);
			else setColorSet();
		}
		
		window.onload = init;
	</script>
</head>
<body>
<canvas id="canvas" height="500" width="800"></canvas>
<div id="controls">
	<div>
    	<span><input id="clearButton" type="button" value="Clear Canvas"/></span>
    	<span style="float:right"><input id='saveButton' type='button' value='Save Image'/></span>
	</div>
	
	<div>
		<label for="slider1">Palette Size</label>
		<input id="slider1" type ="range" min ="1" max="10" step ="1" value ="4"/>
		<span style="float:right" id="sliderResults">???</span>
	</div>
	<div>
		<span>
			<label for="myCheckbox">Opacity</label>
			<input type="checkbox" id="myCheckbox">
		</span>
		<span style="float:right" id="checkboxResults">???</span>
	</div>
	<hr>
	<form action="GET">
		Use Color Set<input type="checkbox" value="" name="color" onchange="setType(this.checked)"><br>
		Base Color:  <input type="color" value="#337711" oninput="setColor(this.value)"><br>
		<input name="scheme" type="radio" value="triad" onchange="setScheme(this.value)" > Triad <br>
		<input name="scheme" type="radio" value="tetrad" onchange="setScheme(this.value)" > Tetrad<br>
		<input name="scheme" type="radio" value="monochromatic" onchange="setScheme(this.value)" > Monochromatic<br>
		<input name="scheme" type="radio" value="analogous" onchange="setScheme(this.value)" > Analogous<br>
	</form>
</div>

<div id="assignment">
	<h1>Description</h1>
	<p>I made slider change how many colors to choose from.<br> I added other color functions that you can use by checking 'Use Color Set'. The are different color schemes that use the base color as a start.</p>
	<p>I used the tinycolor.js library for the color scheme calculations</p>
</div>
</body>
</html>
